name: Deploy MongoDB to OpenShift

on:
  workflow_dispatch:  # Manual trigger for now

env:
  OCP_API_URL: ${{ secrets.OCP_API_URL }}
  OCP_TOKEN: ${{ secrets.OCP_TOKEN }}

jobs:
  deploy-mongodb:
    runs-on: ubuntu-latest

    steps:
    - name: ğŸ“¥ Checkout Code
      uses: actions/checkout@v3

    - name: ğŸ“¦ Install OpenShift CLI
      run: |
        curl -LO https://mirror.openshift.com/pub/openshift-v4/clients/oc/latest/linux/oc.tar.gz
        tar -xzf oc.tar.gz
        sudo mv oc /usr/local/bin/

    - name: ğŸ” Login to OpenShift
      run: |
        oc login $OCP_API_URL --token=$OCP_TOKEN --insecure-skip-tls-verify=true

    - name: ğŸ§± Apply MongoDB Deployment YAML
      run: |
        oc apply -f manifests/mongodb-deployment.yaml
